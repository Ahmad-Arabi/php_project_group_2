<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Checkout - Craftify</title>
    <link href="../../includes/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../includes/css/style.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    
</head>
<body>

<nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">Craftify<span>.</span></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsCraftify">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsCraftify">
            <ul class="navbar-nav ms-auto">
                <li><a class="nav-link" href="index.html">Home</a></li>
                <li><a class="nav-link" href="shop.html">Shop</a></li>
                <li><a class="nav-link" href="about.html">About us</a></li>
                <li><a class="nav-link" href="services.html">Services</a></li>
                <li><a class="nav-link" href="Signin.html">Sign in</a></li>
                <li><a class="nav-link" href="contact.html">Contact us</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container py-5">
    <h1 class="mb-4">Checkout</h1>

    <form action="checkout.php" method="POST">

        <div class="row">
            <div class="col-md-6">
                <h4>Billing Details</h4>

                <div class="mb-4">
                    <input type="text" class="form-control" name="full_name" placeholder="Full Name" required>
                </div>
                <div class="mb-4">
                    <input type="email" class="form-control" name="email" placeholder="Email Address" required>
                </div>
                <div class="mb-4">
                    <input type="text" class="form-control" name="phone" placeholder="Phone Number" required>
                </div>
                <div class="mb-4">
                    <input type="text" class="form-control" name="address" placeholder="country" required>
                </div>
               
            </div>

            <div class="col-md-6">
                <h4>Your Order</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="cartItems">
                        
                    </tbody>
                </table>

                <table class="table">
                    <tbody>
                        <tr><td><strong>Original Total</strong></td><td>$<span id="original_price">0.00</span></td></tr>
                        <tr><td><strong>Discount</strong></td><td>-$<span id="discount_value">0.00</span></td></tr>
                        <tr><td><strong>Order Total</strong></td><td>$<span id="total_price">0.00</span></td></tr>
                    </tbody>
                </table>

                <div class="input-group mb-4">
                    <input type="text" class="form-control" id="coupon_code" name="coupon_code" placeholder="Coupon Code (Optional)">
                    <button type="button" class="btn btn-dark" onclick="applyCoupon()">Apply</button>
                </div>
                <p id="coupon_message" style="color: red; display: none;"></p>

                <button  type="submit" class="btn btn-dark w-100">Place Order</button>
            </div>
        </div>

    </form>
</div>
<!-- Start Footer Section -->
<footer class="footer-section">
	<div class="container relative">


		<div class="row">
			<div class="col-lg-8">
				<div class="subscription-form">
					<h3 class="d-flex align-items-center"><span class="me-1"><img src="images/envelope-outline.svg" alt="Image" class="img-fluid"></span><span>Subscribe to Newsletter</span></h3>

					<form action="#" class="row g-3">
						<div class="col-auto">
							<input type="text" class="form-control" placeholder="Enter your name">
						</div>
						<div class="col-auto">
							<input type="email" class="form-control" placeholder="Enter your email">
						</div>
						<div class="col-auto">
							<button class="btn btn-primary">
								<span class="fa fa-paper-plane"></span>
							</button>
						</div>
					</form>

				</div>
			</div>
		</div>

		<div class="row g-5 mb-5">
			<div class="col-lg-4">
				<div class="mb-4 footer-logo-wrap"><a href="#" class="footer-logo">Craftify<span>.</span></a></div>
				<p class="mb-4">Donec facilisis quam ut purus rutrum lobortis. Custom products that reflect your unique style, for personal use or gifts. Let us bring your ideas to life. Pellentesque habitant</p>

				<ul class="list-unstyled custom-social">
					<li><a href="#"><span class="fa fa-brands fa-facebook-f"></span></a></li>
					<li><a href="#"><span class="fa fa-brands fa-twitter"></span></a></li>
					<li><a href="#"><span class="fa fa-brands fa-instagram"></span></a></li>
					<li><a href="#"><span class="fa fa-brands fa-linkedin"></span></a></li>
				</ul>
			</div>

			<div class="col-lg-8">
				<div class="row links-wrap">
					<div class="col-6 col-sm-6 col-md-3">
						<ul class="list-unstyled">
							<li><a href="#">About us</a></li>
							<li><a href="#">Services</a></li>
							<li><a href="#">Sing in</a></li>
							<li><a href="#">Contact us</a></li>
						</ul>
					</div>
				</div>
			</div>

		</div>

		<div class="border-top copyright">
			<div class="row pt-4">
				<div class="col-lg-6">
					<p class="mb-2 text-center text-lg-start">
						Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; 
						Designed with love by <a href="http://127.0.0.1:5500/furni-ed/index.html">Craftify</a> 
						to offer unique and customized products for you.
					</p>
					
				</div>

				<div class="col-lg-6 text-center text-lg-end">
					<ul class="list-unstyled d-inline-flex ms-auto">
						<li class="me-4"><a href="#">Terms &amp; Conditions</a></li>
						<li><a href="#">Privacy Policy</a></li>
					</ul>
				</div>

			</div>
		</div>

	</div>
</footer>
<!-- End Footer Section -->	


<script>
    // Load user details when page loads
    fetch('get_user_details.php')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.querySelector('[name="full_name"]').value = data.full_name;
                document.querySelector('[name="email"]').value = data.email;
                document.querySelector('[name="phone"]').value = data.phone;
                document.querySelector('[name="address"]').value = data.address;
            }
        });

    // Load cart details
    fetch('get_cart.php')
    .then(response => response.json())
    .then(data => {
    const cartItems = document.getElementById('cartItems');
    cartItems.innerHTML = '';
    data.cart.forEach(item => {
        const row = `<tr>
                        <td>${item.name} x ${item.quantity}</td>
                        <td>$${item.price}</td>
                        <td>${item.quantity}</td>
                        <td>$${(item.price * item.quantity).toFixed(2)}</td>
                    </tr>`;
        cartItems.innerHTML += row;
    });

    document.getElementById('original_price').innerText = data.total_price.toFixed(2);
    document.getElementById('total_price').innerText = data.total_price.toFixed(2);
});

function applyCoupon() {
    const couponCode = document.getElementById('coupon_code').value;
    fetch('apply_coupon.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'coupon_code=' + encodeURIComponent(couponCode)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        const originalTotal = parseFloat(data.original_total);
        const discountValue = parseFloat(data.discount_value);
        const newTotal = parseFloat(data.new_total);
        
        document.getElementById('original_price').innerText = originalTotal.toFixed(2);
        document.getElementById('discount_value').innerText = discountValue.toFixed(2);
        document.getElementById('total_price').innerText = newTotal.toFixed(2);
        document.getElementById('coupon_message').innerText = data.message;
        document.getElementById('coupon_message').style.color = data.success ? 'green' : 'red';
        document.getElementById('coupon_message').style.display = 'block';
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('coupon_message').innerText = 'Error applying coupon';
        document.getElementById('coupon_message').style.color = 'red';
        document.getElementById('coupon_message').style.display = 'block';
    });
}

</script>

</body>
</html>